# rbac
基于自定义注解的基础权限框架

#### 1.所使用的框架

spring boot+spring data JPA + LayUI + FreeMarker

#### 2.核心实现

##### 2.1 核心类
主要使用AOP+自定义注解实现登录拦截和权限控制。核心类为注解PermMark和AOP组件PermissionAspect。

##### 2.2 实现过程

贴上注解PermMark之后的方法（笔者贴在controller上），在服务器启动时会自动加载到数据库。笔者认为，权限不应该给用户太多的自由度，毕竟用户不一定是开发人员，他们不会提前知道你的接口地址或者权限表达式，所以应该由开发人员在开发时就定义好，然后由用户去分配这些权限。登录之后会根据用户的角色加载权限表达式，并保存在session中。每一次用户访问带有注解PermMark的方法时，都会比对一下Session中是否有这个权限表达式，没有则表示没有权限。根据是否要跳转的标识抛出不同的异常，决定是跳转到无权限的页面或者是弹出无权限的弹出框。

#### 3.页面实现

使用富客户端LayUI和模版引擎FreeMarker编写的页面。不得不说LayUI相对于EasyUI之流来说，还是比较美观的。

虽然现阶段已经把权限控制粒度细致到了按钮上，但是页面上并没有完全做到按钮控制或者页面控制，只是在没有权限的情况下会跳转到无权限页面或者弹出无权限的消息框。如果要实现页面上完全的权限控制，比方说，没有权限的按钮或菜单就不显示了，使用FreeMarker避免不了硬编码。如果你有更好的实现思路或者方法，可以Email给我【shushangd@qq.com】

#### 4.表结构

表结构无非就是角色-权限（多对多），用户-角色（一对多）。只是在登录的时候查询用户的所有角色，接着查出角色所有的权限表达式集合，并去重（使用set完全可以省去不必要的麻烦）保存到session中。

#### 5.后话

JPA虽然开发起来快，但是没有mybatis灵活，后续会增加mybatis的版本分支(2018.8.4)

Mybatis分支已上传(2018.8.9)